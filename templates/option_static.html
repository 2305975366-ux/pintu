<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>拼图大师 - 选择关卡</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
</head>
<body>
{% include '_navbar.html' %}
<div class="container" style="max-width: 1200px; margin: 0 auto;">
    <div class="background-blur"></div>
    <div class="page-title" style="margin-top: 20px;">
        <button class="btn btn-secondary back-btn" onclick="window.location.href='{{ url_for('main') }}'" style="padding: 8px 16px; font-size: 12px; margin-right: 16px;">
            <span class="chinese-text">返回</span>
        </button>
        <span class="chinese-text" style="color: #F9E078; font-size: 18px;">选择关卡</span>
    </div>

    <div class="filter-area card" style="margin-bottom: 24px; background-color:#20223A;">
        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
            <div style="flex: 1; min-width: 200px;">
                <label class="filter-section-label">风格筛选</label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label class="filter-label active" data-filter="style" data-value="all" style="padding: 8px 16px; border-radius: 0; cursor: pointer; background-color: #F9E078; color: #20223A; border: 2px solid #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">全部</label>
                    <label class="filter-label" data-filter="style" data-value="nature" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">自然风光</label>
                    <label class="filter-label" data-filter="style" data-value="animal" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">动物</label>
                    <label class="filter-label" data-filter="style" data-value="building" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">建筑</label>
                    <label class="filter-label" data-filter="style" data-value="cartoon" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">卡通</label>
                </div>
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label class="filter-section-label">难度筛选</label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label class="filter-label active" data-filter="difficulty" data-value="all" style="padding: 8px 16px; border-radius: 0; cursor: pointer; background-color: #F9E078; color: #20223A; border: 2px solid #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">全部</label>
                    <label class="filter-label" data-filter="difficulty" data-value="3" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">简单<span class="symbol-text">（</span><span class="number-text">3</span><span class="symbol-text">×</span><span class="number-text">3</span><span class="symbol-text">）</span></label>
                    <label class="filter-label" data-filter="difficulty" data-value="4" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">中等<span class="symbol-text">（</span><span class="number-text">4</span><span class="symbol-text">×</span><span class="number-text">4</span><span class="symbol-text">）</span></label>
                    <label class="filter-label" data-filter="difficulty" data-value="5" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">困难<span class="symbol-text">（</span><span class="number-text">5</span><span class="symbol-text">×</span><span class="number-text">5</span><span class="symbol-text">）</span></label>
                </div>
            </div>
        </div>
    </div>

    <div class="level-list" id="levelList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
        <!-- 自然风光关卡 -->
        <div class="level-card card" data-style="nature" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_lake_3', '{{ url_for('static', filename='images/nature/lake.png') }}', 3)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/lake.png') }}" alt="湖泊-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">湖泊 - 简单</h3>
            <p style="font-size: 12px; color: #B8BCC8;">你的最佳成绩：<span class="number-text">02</span><span class="symbol-text">:</span><span class="number-text">15</span> <span class="symbol-text">|</span> <span class="number-text">38</span>步</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/lake.png') }}', 3);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="4" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_snow_4', '{{ url_for('static', filename='images/nature/snow.png') }}', 4)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/snow.png') }}" alt="雪山-中等" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FAAD14; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">中等</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">雪山 - 中等</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/snow.png') }}', 4);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="5" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_mountain_5', '{{ url_for('static', filename='images/nature/mountain.png') }}', 5)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/mountain.png') }}" alt="山峰-困难" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FF4D4F; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">困难</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">山峰 - 困难</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/mountain.png') }}', 5);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_desert_3', '{{ url_for('static', filename='images/nature/desert.png') }}', 3)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/desert.png') }}" alt="沙漠-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">沙漠 - 简单</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/desert.png') }}', 3);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="4" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_ocean_4', '{{ url_for('static', filename='images/nature/ocean.png') }}', 4)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/ocean.png') }}" alt="海洋-中等" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FAAD14; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">中等</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">海洋 - 中等</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/ocean.png') }}', 4);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="5" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_meteor_5', '{{ url_for('static', filename='images/nature/meteor.png') }}', 5)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/meteor.png') }}" alt="流星-困难" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FF4D4F; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">困难</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">流星 - 困难</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/meteor.png') }}', 5);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_field_3', '{{ url_for('static', filename='images/nature/field.png') }}', 3)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/field.png') }}" alt="田野-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">田野 - 简单</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/field.png') }}', 3);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="4" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_valley_4', '{{ url_for('static', filename='images/nature/valley.png') }}', 4)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/valley.png') }}" alt="山谷-中等" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FAAD14; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">中等</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">山谷 - 中等</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/valley.png') }}', 4);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="nature" data-difficulty="5" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('nature_woods_5', '{{ url_for('static', filename='images/nature/woods.png') }}', 5)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/woods.png') }}" alt="森林-困难" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FF4D4F; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">困难</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">森林 - 困难</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/nature/woods.png') }}', 5);">编辑</button>
        </div>

        <!-- 动物关卡 -->
        <div class="level-card card" data-style="animal" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('animal_chicken_3', '{{ url_for('static', filename='images/animals/chicken.png') }}', 3)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/animals/chicken.png') }}" alt="小鸡-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">小鸡 - 简单</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/animals/chicken.png') }}', 3);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="animal" data-difficulty="4" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('animal_dolphin_4', '{{ url_for('static', filename='images/animals/dolphin.png') }}', 4)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/animals/dolphin.png') }}" alt="海豚-中等" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FAAD14; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">中等</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">海豚 - 中等</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/animals/dolphin.png') }}', 4);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="animal" data-difficulty="5" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('animal_pikachu_5', '{{ url_for('static', filename='images/animals/pikachu.webp') }}', 5)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/animals/pikachu.webp') }}" alt="皮卡丘-困难" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FF4D4F; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">困难</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">皮卡丘 - 困难</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/animals/pikachu.webp') }}', 5);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="animal" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('animal_psyduck_3', '{{ url_for('static', filename='images/animals/psyduck.webp') }}', 3)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/animals/psyduck.webp') }}" alt="可达鸭-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">可达鸭 - 简单</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/animals/psyduck.webp') }}', 3);">编辑</button>
        </div>

        <!-- 建筑关卡 -->
        <div class="level-card card" data-style="building" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('building_church_3', '{{ url_for('static', filename='images/architecture/church.png') }}', 3)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/architecture/church.png') }}" alt="教堂-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">教堂 - 简单</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/architecture/church.png') }}', 3);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="building" data-difficulty="4" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('building_garden_4', '{{ url_for('static', filename='images/architecture/garden.png') }}', 4)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/architecture/garden.png') }}" alt="花园-中等" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FAAD14; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">中等</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">花园 - 中等</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/architecture/garden.png') }}', 4);">编辑</button>
        </div>
        
        <div class="level-card card" data-style="building" data-difficulty="5" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('building_pyramid_5', '{{ url_for('static', filename='images/architecture/pyramid.png') }}', 5)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/architecture/pyramid.png') }}" alt="金字塔-困难" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FF4D4F; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">困难</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">金字塔 - 困难</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/architecture/pyramid.png') }}', 5);">编辑</button>
        </div>

        <!-- 卡通关卡 -->
        <div class="level-card card" data-style="cartoon" data-difficulty="5" style="cursor: pointer; position: relative; background-color:#20223A;" onclick="selectLevel('cartoon_nikki_5', '{{ url_for('static', filename='images/cartoon/nikki.png') }}', 5)">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/cartoon/nikki.png') }}" alt="妮可-困难" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #FF4D4F; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">困难</span>
            </div>
            <h3 style="font-size: 16px; margin-bottom: 8px;">暖暖 - 困难</h3>
            <p style="font-size: 12px; color: #B8BCC8;">未挑战该难度</p>
            <button class="btn" style="position: absolute; right: 12px; bottom: 12px; font-size: 10px;" onclick="event.stopPropagation(); editLevel('{{ url_for('static', filename='images/cartoon/nikki.png') }}', 5);">编辑</button>
        </div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <button id="enterGameBtn" class="btn btn-primary" style="padding: 12px 40px; font-size: 10px;" disabled>进入游戏</button>
    </div>
</div>

<script>
let selectedLevelId = '';
let selectedImage = '';
let selectedDifficulty = 3;
let currentStyleFilter = 'all';
let currentDifficultyFilter = 'all';

// 筛选功能
function applyFilters() {
    const levelCards = document.querySelectorAll('.level-card');
    
    levelCards.forEach(card => {
        const cardStyle = card.getAttribute('data-style');
        const cardDifficulty = card.getAttribute('data-difficulty');
        
        let showCard = true;
        
        // 风格筛选
        if (currentStyleFilter !== 'all' && cardStyle !== currentStyleFilter) {
            showCard = false;
        }
        
        // 难度筛选
        if (currentDifficultyFilter !== 'all' && cardDifficulty !== currentDifficultyFilter) {
            showCard = false;
        }
        
        // 显示/隐藏卡片
        if (showCard) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// 筛选按钮点击事件
document.querySelectorAll('.filter-label').forEach(label => {
    label.addEventListener('click', () => {
        const filterType = label.getAttribute('data-filter');
        const filterValue = label.getAttribute('data-value');
        
        // 移除同组其他按钮的active状态
        const parent = label.parentElement;
        parent.querySelectorAll('.filter-label').forEach(btn => {
            btn.classList.remove('active');
            btn.style.backgroundColor = '#20223A';
            btn.style.color = '#F9E078';
        });
        
        // 设置当前按钮为active状态
        label.classList.add('active');
        label.style.backgroundColor = '#F9E078';
        label.style.color = '#20223A';
        
        // 更新筛选条件
        if (filterType === 'style') {
            currentStyleFilter = filterValue;
        } else if (filterType === 'difficulty') {
            currentDifficultyFilter = filterValue;
        }
        
        // 应用筛选
        applyFilters();
    });
});

// 选择关卡
function selectLevel(id, image, difficulty) {
    selectedLevelId = id;
    selectedImage = image;
    selectedDifficulty = difficulty;
    
    // 移除所有卡片的选中状态
    document.querySelectorAll('.level-card').forEach(card => {
        card.style.border = '1px solid #E5E7EB';
    });
    
    // 设置当前卡片为选中状态
    event.currentTarget.style.border = '2px solid #F9E078';
    
    // 启用进入游戏按钮
    document.getElementById('enterGameBtn').disabled = false;
}

// 编辑关卡
function editLevel(image, difficulty) {
    localStorage.setItem('customImage', image);
    localStorage.setItem('customSize', difficulty);
    window.location.href = '{{ url_for('editor_page') }}';
}

// 进入游戏
document.getElementById('enterGameBtn').addEventListener('click', () => {
    localStorage.setItem('customImage', selectedImage);
    localStorage.setItem('customSize', selectedDifficulty);
    window.location.href = '{{ url_for('game_page') }}';
});

// 筛选按钮悬停效果
document.querySelectorAll('.filter-label').forEach(label => {
    label.addEventListener('mouseenter', () => {
        if (!label.classList.contains('active')) {
            label.style.transform = 'translateY(-2px)';
            label.style.boxShadow = '5px 5px 0 #000000';
        }
    });
    
    label.addEventListener('mouseleave', () => {
        if (!label.classList.contains('active')) {
            label.style.transform = 'translateY(0)';
            label.style.boxShadow = '3px 3px 0 #000000';
        }
    });
});

// 页面加载时获取用户关卡记录
document.addEventListener('DOMContentLoaded', function() {
    loadUserLevelRecords();
});

// 加载用户关卡记录
function loadUserLevelRecords() {
    const token = localStorage.getItem('puzzleToken');
    if (!token) {
        return; // 未登录用户不加载记录
    }
    
    fetch('/levels/records', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.code === 200) {
            updateLevelCards(data.data);
        }
    })
    .catch(error => {
        console.error('加载关卡记录失败:', error);
    });
}

// 更新关卡卡片显示
function updateLevelCards(records) {
    const levelCards = document.querySelectorAll('.level-card');
    
    levelCards.forEach(card => {
        const levelId = card.getAttribute('onclick').match(/'([^']+)'/)[1];
        const record = records.find(r => r.level_id === levelId);
        
        if (record) {
            const statusElement = card.querySelector('p');
            if (statusElement) {
                statusElement.innerHTML = record.status_text;
            }
        }
    });
}

// 格式化时间显示
function formatTime(seconds) {
    if (!seconds) return "00:00";
    const minutes = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}
</script>
    <!-- 页面特定的背景音乐 -->
    <script>
        // 等待音乐管理器加载完成
        function initPageMusic() {
            if (window.musicManager) {
                // 静态选择页面自动播放主界面音乐
                window.musicManager.playScene('main');
            } else {
                // 如果音乐管理器尚未加载，稍后重试
                setTimeout(initPageMusic, 100);
            }
        }
        
        // 页面加载完成后直接初始化音乐，无需等待用户交互
        document.addEventListener('DOMContentLoaded', function() {
            // 直接尝试播放音乐
            initPageMusic();
        });
    </script>
</body>
</html>
