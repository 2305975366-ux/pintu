<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>我的拼图</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
</head>
<body>
{% include '_navbar.html' %}
<div class="container" style="max-width: 1200px; margin: 0 auto;">
    <div class="background-blur"></div>
    <div class="page-title" style="margin-top: 20px;">
        <button class="btn btn-secondary back-btn" onclick="window.location.href='{{ url_for('main') }}'" style="padding: 8px 16px; font-size: 12px; margin-right: 16px;">
            <span class="chinese-text">返回</span>
        </button>
        <span class="chinese-text" style="color: #F9E078; font-size: 18px;">我的拼图</span>
        <button class="btn btn-danger" style="margin-left: auto; padding: 8px 16px; font-size: 12px;">
            <span class="chinese-text">清理全部存档</span>
        </button>
    </div>

    <div class="filter-area card" style="margin-bottom: 24px; background-color:#20223A;">
        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
            <div style="flex: 1; min-width: 200px;">
                <label class="filter-section-label">状态筛选</label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label class="filter-label active" data-filter="status" data-value="all" style="padding: 8px 16px; border-radius: 0; cursor: pointer; background-color: #F9E078; color: #20223A; border: 2px solid #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">全部</label>
                    <label class="filter-label" data-filter="status" data-value="playing" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">进行中</label>
                    <label class="filter-label" data-filter="status" data-value="completed" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">已完成</label>
                </div>
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label class="filter-section-label">难度筛选</label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <label class="filter-label active" data-filter="difficulty" data-value="all" style="padding: 8px 16px; border-radius: 0; cursor: pointer; background-color: #F9E078; color: #20223A; border: 2px solid #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">全部</label>
                    <label class="filter-label" data-filter="difficulty" data-value="3" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">简单<span class="symbol-text">（</span><span class="number-text">3</span><span class="symbol-text">×</span><span class="number-text">3</span><span class="symbol-text">）</span></label>
                    <label class="filter-label" data-filter="difficulty" data-value="4" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">中等<span class="symbol-text">（</span><span class="number-text">4</span><span class="symbol-text">×</span><span class="number-text">4</span><span class="symbol-text">）</span></label>
                    <label class="filter-label" data-filter="difficulty" data-value="5" style="padding: 8px 16px; border-radius: 0; cursor: pointer; border: 2px solid #F9E078; background: #20223A; color: #F9E078; box-shadow: 3px 3px 0 #000000; font-family: 'Press Start 2P', 'Zpix', monospace; font-size: 12px; transition: all 0.1s ease;">困难<span class="symbol-text">（</span><span class="number-text">5</span><span class="symbol-text">×</span><span class="number-text">5</span><span class="symbol-text">）</span></label>
                </div>
            </div>
        </div>
    </div>

    <div class="puzzle-list" id="puzzleList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-bottom: 80px;">
        <!-- 示例存档卡片 -->
        <div class="puzzle-card card" data-status="playing" data-difficulty="3" style="cursor: pointer; position: relative; background-color:#20223A;">
            <div style="position: relative; margin-bottom: 12px;">
                <img src="{{ url_for('static', filename='images/nature/lake.png') }}" alt="湖泊-简单" style="width: 100%; height: 140px; object-fit: cover; border-radius: 4px;">
                <span style="position: absolute; top: 8px; left: 8px; background-color: #52C41A; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">简单</span>
                <span style="position: absolute; top: 8px; right: 8px; background-color: #1890FF; color: #FFF; font-size: 12px; padding: 2px 8px; border-radius: 4px;">进行中</span>
            </div>
            <h3 class="chinese-text" style="font-size: 16px; color: #F9E078; margin-bottom: 8px;">湖泊 - 简单</h3>
            <div style="font-size: 12px; color: #B8BCC8; margin-bottom: 12px;">
                <div>保存时间：<span class="number-text">2025-01-15</span> <span class="symbol-text">14</span><span class="symbol-text">:</span><span class="number-text">30</span></div>
                <div>已用时：<span class="number-text">01</span><span class="symbol-text">:</span><span class="number-text">20</span></div>
                <div>已走步数：<span class="number-text">22</span>步</div>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 10px;">
                <button class="btn btn-primary" onclick="continueGame('lake_3')" style="flex: 1; padding: 8px; font-size: 12px;">
                    <span class="chinese-text">继续游戏</span>
                </button>
                <button class="btn btn-danger" onclick="deleteSave('lake_3')" style="flex: 1; padding: 8px; font-size: 12px;">
                    <span class="chinese-text">删除</span>
                </button>
            </div>
        </div>
    </div>

    <div class="empty-state" style="text-align: center; padding: 60px 0; display: none;" id="emptyState">
        <p class="chinese-text" style="font-size: 16px; color: #B8BCC8; margin-bottom: 20px;">暂无游戏存档</p>
        <a class="btn btn-primary" href="{{ url_for('option_page') }}">
            <span class="chinese-text">去开始游戏</span>
        </a>
    </div>
</div>

<!-- 帮助页面模态框 -->
<div class="modal-mask" id="helpModal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <span>操作指南</span>
            <span class="modal-close" onclick="document.getElementById('helpModal').style.display='none'">×</span>
        </div>
        <div class="modal-body" style="font-size: 14px; line-height: 24px; color: #E0E0E0;">
            <p><strong style="color: #F9E078;">1. 游戏操作</strong></p>
            <p>- 鼠标左键长按图块，拖拽到拼图区域</p>
            <p>- 单击选中的图块，顺时针旋转90度</p>
            <p>- 点击"撤销"可还原上一步操作，"重做"恢复撤销操作</p>
            <p><strong style="color: #F9E078; margin-top: 16px; display: block;">2. 自定义拼图</strong></p>
            <p>- 支持上传本地图片（JPG/PNG，最大5MB），可裁剪调整</p>
            <p>- 可设置拼图块数（4-64块）、形状（矩形/异形）、是否旋转</p>
            <p><strong style="color: #F9E078; margin-top: 16px; display: block;">3. 存档与分享</strong></p>
            <p>- 登录用户存档同步至服务器，游客存档仅保存在当前浏览器</p>
            <p>- 自定义拼图可分享至"分享中心"，供其他玩家游玩</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="document.getElementById('helpModal').style.display='none'">我知道了</button>
        </div>
    </div>
</div>

<script>
// 筛选功能
document.addEventListener('DOMContentLoaded', function() {
    const filterLabels = document.querySelectorAll('.filter-label');
    const puzzleCards = document.querySelectorAll('.puzzle-card');
    const emptyState = document.getElementById('emptyState');
    const puzzleList = document.getElementById('puzzleList');
    
    // 筛选按钮点击事件
    filterLabels.forEach(label => {
        label.addEventListener('click', function() {
            const filterType = this.getAttribute('data-filter');
            const filterValue = this.getAttribute('data-value');
            
            // 更新同类型筛选按钮的激活状态
            document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(btn => {
                btn.classList.remove('active');
                btn.style.backgroundColor = '#20223A';
                btn.style.color = '#F9E078';
            });
            
            // 激活当前按钮
            this.classList.add('active');
            this.style.backgroundColor = '#F9E078';
            this.style.color = '#20223A';
            
            // 应用筛选
            applyFilters();
        });
    });
    
    // 应用筛选
    function applyFilters() {
        const statusFilter = document.querySelector('[data-filter="status"].active').getAttribute('data-value');
        const difficultyFilter = document.querySelector('[data-filter="difficulty"].active').getAttribute('data-value');
        
        let visibleCount = 0;
        
        puzzleCards.forEach(card => {
            const cardStatus = card.getAttribute('data-status');
            const cardDifficulty = card.getAttribute('data-difficulty');
            
            const statusMatch = statusFilter === 'all' || cardStatus === statusFilter;
            const difficultyMatch = difficultyFilter === 'all' || cardDifficulty === difficultyFilter;
            
            if (statusMatch && difficultyMatch) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // 显示/隐藏空状态
        if (visibleCount === 0) {
            puzzleList.style.display = 'none';
            emptyState.style.display = 'block';
        } else {
            puzzleList.style.display = 'grid';
            emptyState.style.display = 'none';
        }
    }
});

// 继续游戏
function continueGame(saveId) {
    // 这里可以加载存档数据并跳转到游戏页面
    console.log('继续游戏:', saveId);
    window.location.href = '{{ url_for('game_page') }}';
}

// 删除存档
function deleteSave(saveId) {
    if (confirm('确定要删除这个存档吗？')) {
        // 这里可以调用删除存档的API
        console.log('删除存档:', saveId);
        // 删除成功后刷新页面或移除对应的卡片
    }
}
</script>
    <!-- 页面特定的背景音乐 -->
    <script>
        // 等待音乐管理器加载完成
        function initPageMusic() {
            if (window.musicManager) {
                // 我的拼图页面自动播放主界面音乐
                window.musicManager.playScene('main');
            } else {
                // 如果音乐管理器尚未加载，稍后重试
                setTimeout(initPageMusic, 100);
            }
        }
        
        // 页面加载完成后直接初始化音乐，无需等待用户交互
        document.addEventListener('DOMContentLoaded', function() {
            // 直接尝试播放音乐
            initPageMusic();
        });
    </script>
</body>
</html>


